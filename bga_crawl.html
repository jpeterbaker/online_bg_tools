<html>
<script>

function run_when_ready(readySelector, callback) {
    var numAttempts = 0;
    var tryNow = function() {
        var elem = document.querySelector(readySelector);
        if (elem) {
            callback();
        }
        else {
            numAttempts++;
            if (numAttempts >= 34) {
                console.warn('Giving up after 34 attempts. Could not find: ' + readySelector);
            }
            else {
                setTimeout(tryNow, 250 * Math.pow(1.1, numAttempts));
            }
        }
    };
    tryNow();
}

function save(filename, text) {
    // Write text to a file and offer to download it
    const blob = new Blob([data], {type: 'text/csv'});
    if(window.navigator.msSaveOrOpenBlob) {
        // This version seems to work on some browsers
        window.navigator.msSaveBlob(blob, filename);
    }
    else{
        // and this one works on other browsers
        const elem = window.document.createElement('a');
        elem.href = window.URL.createObjectURL(blob);
        elem.download = filename;        
        document.body.appendChild(elem);
        elem.click();        
        document.body.removeChild(elem);
    }
}

function get_log(n) {
    // Get the text of the game record
    var dest = 'https://boardgamearena.com/gamereview?table=' + n;
    window.location.replace(dest);
    var text;
    function retrieve(){
        text = document.querySelector('.pagesection__content').innerText;
    }
    run_when_ready('.pagesection__content',retrieve);
    return text;
}

</script>
<div style='
    border-radius:7px;
    padding:0px 5px;
    border-color:black;
    border-style:solid;
    border-width:1px;
    background-color:pink;
    cursor:pointer;
    vertical-align:middle;
    box-shadow:1px 1px 0px black;
    line-height:normal;
    font-size:14px;
    width:70px;
    text-align:center;
    border-spacing:5px;
    padding:6px 12px;'
    onclick = 'gradual_transfer()'>Retrieve table logs</div>
<textarea rows='20' cols='30' id='incoming' style='padding:5px;margin:20px'>
Enter table numbers separated by line breaks
</textarea>
<div style='border:1px solid black;padding:10px'>Progress will be shown here</div>
</html>


